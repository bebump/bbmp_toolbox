#!/bin/bash

# Run this script before committing to the directory.
#
# It deletes an existing .venv directory and then runs bootstrap-and-test.
#
# This is to ensure that if the version number has been changed in
# pyproject.toml since the last commit, it will be freshly installed with
# this new version into the new .venv, and can be reflected in e.g.
# autogenerated documentation.

set -e
SELF_DIR="$(cd "$(dirname "$0")"; pwd)"

VENV_PYTHON="$SELF_DIR/.venv"

if [ -d "$VENV_PYTHON" ]; then
    echo "[pre-commit]: Deleting existing .venv directory at $VENV_PYTHON"
    rm -rf "$VENV_PYTHON"
fi

"$SELF_DIR"/bootstrap-and-test
